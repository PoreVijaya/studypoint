{% extends 'school/adminbase.html' %}
{% load widget_tweaks %}

{% block content %}

<head>
  <style>
    body {
      background-color: #f4f7fc;
    }
  </style>
</head>
<h3 class="text-dark ms-2">Notice</h3>
<div class="container mt-3">
  <!-- Add Notice Form -->
  <div class="card w-50 mx-auto shadow p-3 rounded">
    <form method="post">
      {% csrf_token %}
      <div class="mb-3">
        <label class="form-label fw-semibold">Notice Message</label>
        {% render_field form.message  rows="3" class="form-control expandable-textarea" placeholder="Write your notice here..." %}
      </div>
      <div class="mb-3">
        <label class="form-label fw-semibold">Expiration Date</label>
        {% render_field form.expiration_date class="form-control" %}
      </div>
      <div class="text-center">
        <button type="submit" class="btn btn-primary">Post Notice</button>
      </div>
    </form>
  </div>

  <!-- Notices Table -->
  <div class="card p-3 mt-5 shadow rounded">
    <h5 class="text-dark">Your Notices</h5>
    <hr/>
    <div class="table-container">
      <div class="table-responsive">
        <table class="table table-striped mt-3">
          <thead class="table-primary">
            <tr>
              <th style="width: 10%;">Date</th>
              <th style="width: 70%;">Message</th>
              <th style="width: 10%;">Expires On</th>
              <th class="text-center" style="width: 10%;">Actions</th>
            </tr>
          </thead>
          <tbody class="">
            {% for notice in notices %}
            <tr>
              <td>{{ notice.date }}</td>
              <td style="white-space: pre-wrap;">{{ notice.message }}</td>
              <td>
                {% if notice.expiration_date %}
                <span class="badge bg-danger">{{ notice.expiration_date }}</span>
                {% else %}
                <span class="badge bg-success">No Expiry</span>
                {% endif %}
              </td>
              <td>
                <div class="text-center">
                  <a href="{% url 'edit-notice' notice.id %}" class="btn btn-sm m-1 btn-primary"><i
                      class="fa-solid fa-pen-nib"></i></a>
                  <button class="btn btn-sm m-1 btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal"
                    data-url="{% url 'delete-notice' notice.id %}"><i class="fa-solid fa-trash"></i></button>
                </div>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="4" class="text-muted">No notices available.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteModalLabel">Confirm Deletion</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete this notice? This action cannot be undone.
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <a id="confirmDelete" href="#" class="btn btn-danger">Delete</a>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap 5 JavaScript -->
<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script> -->

<script>
  document.addEventListener("DOMContentLoaded", function () {
    var deleteModal = document.getElementById("deleteModal");
    deleteModal.addEventListener("show.bs.modal", function (event) {
      var button = event.relatedTarget;
      var deleteUrl = button.getAttribute("data-url");
      document.getElementById("confirmDelete").setAttribute("href", deleteUrl);
    });

    // Auto-expand textarea as user types
    var textarea = document.querySelector(".expandable-textarea");
    textarea.addEventListener("input", function () {
      this.style.height = "60px";
      this.style.height = (this.scrollHeight) + "px";
    });
  });
</script>

{% endblock content %}